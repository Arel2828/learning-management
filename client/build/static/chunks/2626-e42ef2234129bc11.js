"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2626],{2857:(e,r,t)=>{t.d(r,{Z:()=>o});var s=t(57437),a=t(3274);t(2265);let o=()=>(0,s.jsxs)("div",{className:"loading",children:[(0,s.jsx)(a.Z,{className:"loading__spinner"}),(0,s.jsx)("span",{className:"loading__text",children:"Loading..."})]})},84647:(e,r,t)=>{t.d(r,{U:()=>u});var s=t(2265),a=t(16463),o=t(51994),n=t(5267);let u=()=>{var e;let{courseId:r,chapterId:t}=(0,a.useParams)(),{user:u,isLoaded:c}=(0,n.aF)(),[i,l]=(0,s.useState)(!1),[d]=(0,o.NG)(),{data:p,isLoading:h}=(0,o.Ky)(null!=r?r:"",{skip:!r}),{data:y,isLoading:g}=(0,o.Ie)({userId:null!==(e=null==u?void 0:u.id)&&void 0!==e?e:"",courseId:null!=r?r:""},{skip:!c||!u||!r}),v=null==p?void 0:p.sections.find(e=>e.chapters.some(e=>e.chapterId===t)),m=null==v?void 0:v.chapters.find(e=>e.chapterId===t);return{user:u,courseId:r,chapterId:t,course:p,userProgress:y,currentSection:v,currentChapter:m,isLoading:!c||h||g,isChapterCompleted:()=>{var e;if(!v||!m||!(null==y?void 0:y.sections))return!1;let r=y.sections.find(e=>e.sectionId===v.sectionId);return null!==(e=null==r?void 0:r.chapters.some(e=>e.chapterId===m.chapterId&&e.completed))&&void 0!==e&&e},updateChapterProgress:(e,t,s)=>{u&&d({userId:u.id,courseId:null!=r?r:"",progressData:{sections:[{sectionId:e,chapters:[{chapterId:t,completed:s}]}]}})},hasMarkedComplete:i,setHasMarkedComplete:l}}},49354:(e,r,t)=>{t.d(r,{E3:()=>d,G_:()=>i,QG:()=>l,T4:()=>c,cn:()=>u,kg:()=>p});var s=t(44839),a=t(96164),o=t(59772),n=t(27776);function u(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,a.m6)((0,s.W)(r))}function c(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format((e||0)/100)}function i(e){return((e||0)/100).toString()}o.Z_().transform(e=>{let r=parseFloat(e);return isNaN(r)?"0":(function(e){return Math.round(100*("string"==typeof e?parseFloat(e):e))})(r).toString()});let l=[{value:"N-5",label:"N-5"},{value:"N-4",label:"N-4"},{value:"N-3",label:"N-3"},{value:"N-2",label:"N-2"}],d=(e,r)=>{let t=new FormData;t.append("title",e.courseTitle),t.append("description",e.courseDescription),t.append("category",e.courseCategory),t.append("price",e.coursePrice.toString()),t.append("status",e.courseStatus?"Published":"Draft");let s=r.map(e=>({...e,chapters:e.chapters.map(e=>({...e,video:e.video}))}));return t.append("sections",JSON.stringify(s)),t},p=async(e,r,t)=>{let s=e.map(e=>({...e,chapters:e.chapters.map(e=>({...e}))}));for(let e=0;e<s.length;e++)for(let a=0;a<s[e].chapters.length;a++){let o=s[e].chapters[a];if(o.video instanceof File&&"video/mp4"===o.video.type)try{let n=await h(o,r,s[e].sectionId,t);s[e].chapters[a]=n}catch(e){console.error("Failed to upload video for chapter ".concat(o.chapterId,":"),e)}}return s};async function h(e,r,t,s){let a=e.video;try{let{uploadUrl:o,videoUrl:u}=await s({courseId:r,sectionId:t,chapterId:e.chapterId,fileName:a.name,fileType:a.type}).unwrap();return await fetch(o,{method:"PUT",headers:{"Content-Type":a.type},body:a}),n.A.success("Video uploaded successfully for chapter ".concat(e.chapterId)),{...e,video:u}}catch(r){throw console.error("Failed to upload video for chapter ".concat(e.chapterId,":"),r),r}}},51994:(e,r,t)=>{t.d(r,{Bi:()=>f,Dx:()=>v,Ie:()=>C,Ky:()=>h,NG:()=>T,PW:()=>p,S5:()=>m,_c:()=>i,a_:()=>d,hi:()=>u,iL:()=>y,kD:()=>c,mG:()=>l,ym:()=>g});var s=t(36074),a=t(8507),o=t(27776);let n=async(e,r,t)=>{let a=(0,s.ni)({baseUrl:"http://localhost:8001",prepareHeaders:async e=>{var r,t;let s=await (null===(t=window.Clerk)||void 0===t?void 0:null===(r=t.session)||void 0===r?void 0:r.getToken());return s&&e.set("Authorization","Bearer ".concat(s)),e}});try{var n,u,c,i;let s=await a(e,r,t);if(s.error){let e=s.error.data,r=(null==e?void 0:e.message)||s.error.status.toString()||"An error occurred";o.A.error("Error: ".concat(r))}if(e.method&&"GET"!==e.method){let e=null===(i=s.data)||void 0===i?void 0:i.message;e&&o.A.success(e)}if(s.data)s.data=s.data.data;else if((null===(n=s.error)||void 0===n?void 0:n.status)===204||(null===(c=s.meta)||void 0===c?void 0:null===(u=c.response)||void 0===u?void 0:u.status)===24)return{data:null};return s}catch(e){return{error:{status:"FETCH_ERROR",error:e instanceof Error?e.message:"Unknown error"}}}},u=(0,a.LC)({baseQuery:n,reducerPath:"api",tagTypes:["Courses","Users","UserCourseProgress"],endpoints:e=>({updateUser:e.mutation({query:e=>{let{userId:r,...t}=e;return{url:"users/clerk/".concat(r),method:"PUT",body:t}},invalidatesTags:["Users"]}),getCourses:e.query({query:e=>{let{category:r}=e;return{url:"courses",params:{category:r}}},providesTags:["Courses"]}),getCourse:e.query({query:e=>"courses/".concat(e),providesTags:(e,r,t)=>[{type:"Courses",id:t}]}),createCourse:e.mutation({query:e=>({url:"courses",method:"POST",body:e}),invalidatesTags:["Courses"]}),updateCourse:e.mutation({query:e=>{let{courseId:r,formData:t}=e;return{url:"courses/".concat(r),method:"PUT",body:t}},invalidatesTags:(e,r,t)=>{let{courseId:s}=t;return[{type:"Courses",id:s}]}}),deleteCourse:e.mutation({query:e=>({url:"courses/".concat(e),method:"DELETE"}),invalidatesTags:["Courses"]}),getUploadVideoUrl:e.mutation({query:e=>{let{courseId:r,sectionId:t,chapterId:s,fileName:a,fileType:o}=e;return{url:"courses/".concat(r,"/sections/").concat(t,"/chapters/").concat(s,"/get-upload-url"),method:"POST",body:{fileName:a,fileType:o}}}}),getTransactions:e.query({query:e=>"transactions?userId=".concat(e)}),createStripePaymentIntent:e.mutation({query:e=>{let{amount:r}=e;return{url:"/transactions/stripe/payment-intent",method:"POST",body:{amount:r}}}}),createTransaction:e.mutation({query:e=>({url:"transactions",method:"POST",body:e})}),getUserEnrolledCourses:e.query({query:e=>"users/course-progress/".concat(e,"/enrolled-courses"),providesTags:["Courses","UserCourseProgress"]}),getUserCourseProgress:e.query({query:e=>{let{userId:r,courseId:t}=e;return"users/course-progress/".concat(r,"/courses/").concat(t)},providesTags:["UserCourseProgress"]}),updateUserCourseProgress:e.mutation({query:e=>{let{userId:r,courseId:t,progressData:s}=e;return{url:"users/course-progress/".concat(r,"/courses/").concat(t),method:"PUT",body:s}},invalidatesTags:["UserCourseProgress"],async onQueryStarted(e,r){let{userId:t,courseId:s,progressData:a}=e,{dispatch:o,queryFulfilled:n}=r,c=o(u.util.updateQueryData("getUserCourseProgress",{userId:t,courseId:s},e=>{Object.assign(e,{...e,sections:a.sections})}));try{await n}catch(e){c.undo()}}})})}),{useUpdateUserMutation:c,useCreateCourseMutation:i,useUpdateCourseMutation:l,useDeleteCourseMutation:d,useGetCoursesQuery:p,useGetCourseQuery:h,useGetUploadVideoUrlMutation:y,useGetTransactionsQuery:g,useCreateTransactionMutation:v,useCreateStripePaymentIntentMutation:m,useGetUserEnrolledCoursesQuery:f,useGetUserCourseProgressQuery:C,useUpdateUserCourseProgressMutation:T}=u}}]);